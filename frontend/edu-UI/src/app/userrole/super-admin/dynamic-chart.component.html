<div class="dynamic-chart" [ngClass]="type">
  <ng-container [ngSwitch]="type">
    <div *ngSwitchCase="'bar'" class="chart-wrap">
      <svg viewBox="0 0 220 120" preserveAspectRatio="none" class="svg-small">
        <ng-container *ngFor="let r of barRects">
          <rect [attr.x]="r.x" [attr.y]="r.y" [attr.width]="r.width" [attr.height]="r.height" rx="3" [attr.fill]="r.color"></rect>
          <text [attr.x]="r.x + r.width/2" [attr.y]="r.y - 6" text-anchor="middle" font-size="11" font-weight="700" fill="#0b3946">{{ r.value }}</text>
        </ng-container>
      </svg>
      <div class="legend small">
        <div class="legend-item" *ngFor="let r of barRects"><span class="dot" [style.background]="r.color"></span><span class="name">{{r.label}}</span><span class="val">{{r.value}}</span></div>
      </div>
    </div>

    <div *ngSwitchCase="'pie'" class="chart-wrap">
      <svg viewBox="0 0 32 32" class="svg-small pie">
        <circle r="16" cx="16" cy="16" fill="#f3f7fb" />
        <ng-container *ngFor="let s of pieSlices">
          <circle r="10" cx="16" cy="16" fill="none" [attr.stroke]="s.color" stroke-width="8"
            [attr.stroke-dasharray]="s.dasharray" [attr.stroke-dashoffset]="s.dashoffset"></circle>
        </ng-container>
      </svg>
      <div class="legend small">
        <div *ngFor="let s of pieSlices" class="legend-item"><span class="dot" [style.background]="s.color"></span><span class="name">{{s.label}}</span><span class="val">{{s.value}}</span></div>
      </div>
    </div>

    <div *ngSwitchCase="'line'" class="chart-wrap">
      <svg viewBox="0 0 200 60" class="svg-small">
        <polyline [attr.points]="attemptsPointsStr" fill="none" stroke="#0b7285" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" />
        <ng-container *ngFor="let p of attemptPoints">
          <circle [attr.cx]="p.cx" [attr.cy]="p.cy" r="2.5" fill="#0b7285"></circle>
          <text [attr.x]="p.cx" [attr.y]="p.cy - 6" font-size="10" text-anchor="middle" fill="#0b3946">{{p.v}}</text>
        </ng-container>
      </svg>
    </div>

    <div *ngSwitchCase="'gauge'" class="chart-wrap gauge-wrap">
      <svg viewBox="0 0 36 36" class="svg-small gauge">
        <path d="M2 20 A16 16 0 0 1 34 20" fill="none" stroke="#e6f4ff" stroke-width="4"/>
        <path [attr.d]="gaugePathD" fill="none" stroke="#1f7bff" stroke-width="4" stroke-linecap="round"/>
      </svg>
      <div class="metric-overlay">
        <div class="metric-value">{{metricValue}}%</div>
        <div class="metric-label">Average</div>
      </div>
    </div>

    <div *ngSwitchDefault class="chart-wrap">
      <div class="empty">No chart</div>
    </div>
  </ng-container>
</div>
